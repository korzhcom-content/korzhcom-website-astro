<!DOCTYPE html><html lang="en"> <head><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="icon" type="image/ico" sizes="32x32" href="/favicon.ico"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"><title>ASP.NET Identity - Use claims to store additional user&#39;s data</title><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="title" content="ASP.NET Identity - Use claims to store additional user's data"><!-- Open Graph Tags (Facebook) --><meta property="og:type" content="website"><meta property="og:title" content="ASP.NET Identity - Use claims to store additional user's data"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:title" content="ASP.NET Identity - Use claims to store additional user's data"><link rel="stylesheet" href="/src/styles/global.less"><script src="/src/js/metro.js"></script><script src="/src/js/slow-loading.js"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-TTN7QK6N6X"></script> <style>footer{background:#172b4d;color:#fff;font-size:14px;padding:20px 0}footer hr{background:#3b4b68}footer .footer__menu{display:flex;flex-flow:row wrap;justify-content:center;list-style:none inside;font-size:12px;margin:20px 0}footer .footer__menu li{margin:0 10px}footer .footer__menu a{text-decoration:none;color:#fff}footer .mute-text{color:#7f8c97!important}
.blog-image[data-astro-cid-2q5oecfc]{max-height:400px;object-fit:cover}.app-bar[data-astro-cid-2q5oecfc]{border-bottom:1px solid #a6a6a6!important}.toc[data-astro-cid-2q5oecfc] ul[data-astro-cid-2q5oecfc]{list-style:none;margin:0}.toc[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc]{line-height:1.2}.toc[data-astro-cid-2q5oecfc] a[data-astro-cid-2q5oecfc]{color:#7f8c97!important;font-size:14px}.read-more[data-astro-cid-2q5oecfc]{background:#3366be;color:#fff;text-decoration:none;padding:4px 8px;font-size:12px}.category[data-astro-cid-2q5oecfc]{background:#3366be;color:#fff;font-size:12px;text-decoration:none;padding:4px 8px;margin-bottom:8px;border-radius:4px}.datetime[data-astro-cid-2q5oecfc]{font-size:12px;text-decoration:none;margin:0 4px;color:#7f8c97}.blog-cover[data-astro-cid-2q5oecfc]{object-fit:cover;height:200px;margin:10px 0 0;border-radius:10px}.post-links[data-astro-cid-2q5oecfc]{margin:0;padding:0;list-style:square}.post-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc]{margin-left:16px;margin-top:4px;line-height:1.2}.post-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] a[data-astro-cid-2q5oecfc]{text-decoration:none;color:#3b4b68}.post-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] a[data-astro-cid-2q5oecfc]:hover{color:#000}.link-to-post[data-astro-cid-2q5oecfc]{font-size:14px;color:#000}.author-links[data-astro-cid-2q5oecfc]{margin:10px 0}.author-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc]{display:flex;flex-flow:row;align-items:center;margin-bottom:10px}.author-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] img[data-astro-cid-2q5oecfc]{width:54px;height:54px;border-radius:50%;margin-right:10px}.author-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] .author-name[data-astro-cid-2q5oecfc]{font-size:14px;color:#3b4b68;text-decoration:none}.author-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] .author-name[data-astro-cid-2q5oecfc]:hover{color:#000}.author-links[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc] .author-role[data-astro-cid-2q5oecfc]{font-size:12px;color:#969696}.tag[data-astro-cid-2q5oecfc]{display:inline-flex;padding:4px 8px;font-size:11px;border-radius:4px;margin-left:4px;align-items:center;justify-content:center;line-height:1;text-decoration:none;background:#eaeaea;color:#000;text-transform:uppercase}.post-content[data-astro-cid-2q5oecfc] img[data-astro-cid-2q5oecfc]:not(.post-cover){margin:20px 0;border:1px solid #88c0ff;padding:10px;background-color:#ecf3ff}.blog-sidebar-group[data-astro-cid-2q5oecfc]{margin-top:20px}ol[data-astro-cid-2q5oecfc]{list-style:decimal}.cloud-tags[data-astro-cid-2q5oecfc]{margin:10px 0;padding:0;list-style:none inside;font-size:8px;display:flex;flex-flow:row wrap}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc]{display:flex;align-items:center;white-space:nowrap;margin:2px;border:1px solid #dadada;border-radius:4px;padding:0 4px}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-1{font-size:1em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-2{font-size:1.1em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-3{font-size:1.2em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-4{font-size:1.3em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-5{font-size:1.4em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-6{font-size:1.5em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-7{font-size:1.6em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-8{font-size:1.7em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-9{font-size:1.8em}.cloud-tags[data-astro-cid-2q5oecfc] li[data-astro-cid-2q5oecfc].tag-weight-10{font-size:1.9em}.cloud-tags[data-astro-cid-2q5oecfc] .tag-link[data-astro-cid-2q5oecfc]{color:#707070;text-decoration:none}.cloud-tags[data-astro-cid-2q5oecfc] .tag-link[data-astro-cid-2q5oecfc]:hover{color:#000}
</style><script type="module">window.onpageshow=function(a){a.persisted&&window.location.reload()};function n(){Metro.activity.open({type:"cycle",overlayColor:"#fff",overlayAlpha:.6,text:'<div class="mt-2 text-small">Loading...</div>'})}$(()=>{$("body").on("click","a[slow-loading]",function(){n()})});window.dataLayer=window.dataLayer||[];function o(){dataLayer.push(arguments)}o("js",new Date);o("config","G-TTN7QK6N6X");
</script></head> <body class="m4-cloak" style="padding-top:52px"> <section class="container-fluid bg-white fg-dark pos-fixed z-fixed p-0" style="top: 0; left:0; right: 0;"> <nav class="container bg-transparent pos-relative p-0" data-role="appbar" data-expand-point="xl"> <a href="/" class="brand no-hover"><img src="/_astro/korzh_logo.S67Im8d7_2d6AAJ.webp" alt="Logo" width="270" height="53" loading="lazy" decoding="async"></a> <ul class="app-bar-menu ml-auto"> <li> <a href="#" class="dropdown-toggle">EASYQUERY</a> <ul class="d-menu place-right" data-role="dropdown"> <li><a href="/easyquery">EASYQUERY.NET</a></li> <li><a href="/easyquery/javascript">EASYQUERY.JS</a></li> <li><a href="/easy-report-starter-kit">EASYREPORT STARTER KIT</a></li> </ul> </li> <li><a href="/metroui">METRO UI</a></li> <li><a href="/localizer">LOCALIZER</a></li> <li><a href="/blog">BLOG</a></li> <li><a href="/support" slow-loading>SUPPORT</a></li> <li> <a href="#" class="dropdown-toggle">DOCS</a> <ul class="d-menu place-right" data-role="dropdown"> <li><a href="/easyquery/docs" slow-loading>EASYQUERY.NET</a></li> <li><a href="/easyquery/javascript/docs" slow-loading>EASYQUERY.JS</a></li> <li><a href="/easy-report-starter-kit/docs" slow-loading>EASY REPORT STARTER KIT</a></li> <li class="divider"></li> <li><a href="/localizer/docs" slow-loading>LOCALIZER</a></li> <li class="divider"></li> <li><a href="https://metroui.org.ua/intro.html">METRO UI</a></li> </ul> </li> <li><a href="/account" slow-loading><span class="mif-user mr-2"></span>ACCOUNT</a></li> </ul> </nav> </section> <main>  <section class="container-fluid mb-4 border-top bd-default" data-astro-cid-2q5oecfc> <div class="container pl-0 pr-0" data-astro-cid-2q5oecfc> <div class="row mt-4" data-astro-cid-2q5oecfc> <div class="cell-md-9" data-astro-cid-2q5oecfc> <div class="pr-10" data-astro-cid-2q5oecfc> <h1 class="text-bold" data-astro-cid-2q5oecfc>ASP.NET Identity - Use claims to store additional user&#39;s data</h1> <div class="mb-4 text-muted reduce-1 d-flex flex-row" data-astro-cid-2q5oecfc> <span data-astro-cid-2q5oecfc>Category: </span><a class="category ml-2" href="/blog/categories/general" data-astro-cid-2q5oecfc>general</a> <div class="ml-auto" data-astro-cid-2q5oecfc>22, Jan 2018 &bull; 1 min read</div> </div> <img src="/images/auth-claims.png" class="post-cover" alt="Alt text" data-astro-cid-2q5oecfc width="1200" height="100" loading="lazy" decoding="async"> <div class="post-content mt-4" data-astro-cid-2q5oecfc>  <blockquote>
<p><strong>NB</strong>: The solution presented in this article will work in version 2.0 of ASP.NET Core only!
If you use a newer version of ASP.NET Core (e.g. 2.2) - here is a <a href="add-extra-user-claims-aspnet-core-webapp">new post on the same topic</a>.</p>
</blockquote>
<h2 id="introduction">Introduction</h2>
<p>With this post, we start a series of articles that describe the different aspects of using ASP.NET Identity in your ASP.NET (Core) applications.
All the code in the following articles was built for and tested with ASP.NET Core 2.0. However, in most cases, it will work well in earlier versions of .NET framework (4.x) and ASP.NET Identity library (2.x)</p>
<p>One more note. We are NOT going to do an introduction to or describe the basic principles of ASP.NET Core in general or APS.NET Identity in particular. The following material is more for the developers who already have some experience with both of them. If you don’t - please start by reading the tutorials on <a href="https://docs.microsoft.com/en-us/aspnet/core/">ASP.NET Core documentation</a> website and creating your first web app with it.</p>
<h2 id="problem">Problem</h2>
<p>Let’s suppose we created a new ASP.NET Core project using one of the default templates and chose “Individual user account” option for “Authentication”.</p>
<img src="/_astro/anc-identity-newapp01.nwqATpaf_2soAYe.webp" alt="ASP.NET Core - new project with ASP.NET Identity" width="784" height="513" loading="lazy" decoding="async">
<p>Now when we start that newly created project and register new user we will see something like <code>Hello YourEmailAddress@YourCompany.com</code> in the top right part of the index web-page.</p>
<p>Obviously, such kind of greeting is useless in a real-world application and you would like to see the name of the currently logged user there instead (e.g. <code>Hello John Doe</code>).
Let’s figure out how to do it.</p>
<h2 id="solution">Solution</h2>
<p>Here we guess you are already familiar with the claims and <a href="https://docs.microsoft.com/en-us/aspnet/core/security/authorization/claims">claims-based approach</a> for authorization used in ASP.NET Core Identity. If not - please read <a href="https://docs.microsoft.com/en-us/aspnet/core/security/">ASP.NET Core Security</a> documentation first.</p>
<p>To achieve our goal we need to do 2 things:</p>
<ol>
<li>Add necessary information to the list of claims stored with the user’s identity.</li>
<li>Have a simple way of getting that info when needed.</li>
</ol>
<p>But before implementing these two tasks we will need to add a new ContactName field to our model class and update our registration and user management pages accordingly.</p>
<h3 id="0-preparations-contactname-property-in-applicationuser-and-updated-views">0. Preparations: ContactName property in ApplicationUser and updated views</h3>
<p>Let’s add a new <code>ContactName</code> property to the ApplicationUser model class (you can find it in <code>Models</code> folder of your project):</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> ApplicationUser</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">IdentityUser</span><span style="color:#F8F8F2"> {</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> string</span><span style="color:#F8F8F2"> ContactName { </span><span style="color:#FF79C6">get</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">set</span><span style="color:#F8F8F2">; }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>Of course, you can add here some other properties you would like to store with your user’s account, like <code>FirstName</code>, <code>LastName</code>, <code>Country</code>, <code>Address</code>, etc. but for simplicity, we will consider only one additional property.</p>
<p>The next step will be adding a new migration and updating your database.
Just run the following commands from the terminal windows in your project’s folder:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#50FA7B">dotnet</span><span style="color:#F1FA8C"> ef</span><span style="color:#F1FA8C"> migrations</span><span style="color:#F1FA8C"> add</span><span style="color:#F1FA8C"> ContactNameField</span></span></code></pre>
<p>and then</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#50FA7B">dotnet</span><span style="color:#F1FA8C"> ef</span><span style="color:#F1FA8C"> database</span><span style="color:#F1FA8C"> update</span></span></code></pre>
<p>Finally, we will need to add the new field to the views:</p>
<ol>
<li><code>Models\AccountViewModels\RegisterViewModel.cs</code></li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> RegisterViewModel</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">Required</span><span style="color:#F8F8F2">]</span></span>
<span class="line"><span style="color:#F8F8F2">    [</span><span style="color:#8BE9FD;font-style:italic">Display</span><span style="color:#F8F8F2">(Name </span><span style="color:#FF79C6">=</span><span style="color:#E9F284"> &quot;</span><span style="color:#F1FA8C">Name</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">)]</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#FF79C6"> string</span><span style="color:#F8F8F2"> ContactName { </span><span style="color:#FF79C6">get</span><span style="color:#F8F8F2">; </span><span style="color:#FF79C6">set</span><span style="color:#F8F8F2">; }</span></span>
<span class="line"><span style="color:#F8F8F2">   .     .     .     .     .     .</span></span></code></pre>
<ol start="2">
<li><code>Views/Account/Register.chstml</code>
Add the following piece of markup before <code>Email</code> form group</li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">div</span><span style="color:#50FA7B;font-style:italic"> class</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">form-group</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">    &lt;</span><span style="color:#FF79C6">label</span><span style="color:#50FA7B;font-style:italic"> asp-for</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ContactName</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">&gt;&lt;/</span><span style="color:#FF79C6">label</span><span style="color:#F8F8F2">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">    &lt;</span><span style="color:#FF79C6">input</span><span style="color:#50FA7B;font-style:italic"> asp-for</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ContactName</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> class</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">form-control</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2"> /&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">    &lt;</span><span style="color:#FF79C6">span</span><span style="color:#50FA7B;font-style:italic"> asp-validation-for</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ContactName</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> class</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">text-danger</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">&gt;&lt;/</span><span style="color:#FF79C6">span</span><span style="color:#F8F8F2">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">&lt;/</span><span style="color:#FF79C6">div</span><span style="color:#F8F8F2">&gt;</span></span></code></pre>
<ol start="3">
<li><code>Controllers/AccountController</code>
Update the following line in the Register method:</li>
</ol>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">var</span><span style="color:#F8F8F2"> user </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> new</span><span style="color:#8BE9FD;font-style:italic"> ApplicationUser</span><span style="color:#F8F8F2"> { ContactName</span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2">model.ContactName, UserName </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> model.Email, Email </span><span style="color:#FF79C6">=</span><span style="color:#F8F8F2"> model.Email };</span></span></code></pre>
<p>After that, perform the similar steps in</p>
<ul>
<li><code>View/Manage/Index.cshtml</code>,</li>
<li><code>Models/ManageViewModels/IndexViewModel.cs</code>
and in</li>
<li><code>Index</code> method in <code>ManageControler</code> class.</li>
</ul>
<p>Try to run your project and open the registration page. Now it should look this way:</p>
<img src="/_astro/anc-identity-registration.Hz7TeInM_ZvHivA.webp" alt="Registration form with ContactName field" width="500" height="487" loading="lazy" decoding="async">
<p>Now, when all the preparations are finished we can return back to our main tasks.</p>
<h3 id="1-adding-a-users-name-to-the-claims">1. Adding a user’s name to the claims</h3>
<p>It appears that the main task is much easier than all the preparations we made before. :)</p>
<p>The quickest way to add some additional claims to the user’s identity is to create your own implementation of <code>IUserClaimsPrincipalFactory</code> and register it in DI container.</p>
<p>Here is the implementation of <code>IUserClaimsPrincipalFactory</code> which adds the value stored in <code>ContactName</code> property to the user’s claims:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> class</span><span style="color:#8BE9FD"> MyUserClaimsPrincipalFactory</span><span style="color:#F8F8F2"> : </span><span style="color:#8BE9FD;font-style:italic">UserClaimsPrincipalFactory</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ApplicationUser</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">IdentityRole</span><span style="color:#F8F8F2">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2">{</span></span>
<span class="line"><span style="color:#FF79C6">    public</span><span style="color:#50FA7B"> MyUserClaimsPrincipalFactory</span><span style="color:#F8F8F2">(</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        UserManager</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ApplicationUser</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FFB86C;font-style:italic">userManager</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        RoleManager</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">IdentityRole</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FFB86C;font-style:italic">roleManager</span><span style="color:#F8F8F2">,</span></span>
<span class="line"><span style="color:#8BE9FD;font-style:italic">        IOptions</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">IdentityOptions</span><span style="color:#F8F8F2">&gt; </span><span style="color:#FFB86C;font-style:italic">optionsAccessor</span><span style="color:#F8F8F2">)</span></span>
<span class="line"><span style="color:#F8F8F2">        : </span><span style="color:#BD93F9;font-style:italic">base</span><span style="color:#F8F8F2">(userManager, roleManager, optionsAccessor) {</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6">    protected</span><span style="color:#FF79C6"> override</span><span style="color:#FF79C6"> async</span><span style="color:#8BE9FD;font-style:italic"> Task</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ClaimsIdentity</span><span style="color:#F8F8F2">&gt; </span><span style="color:#50FA7B">GenerateClaimsAsync</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">ApplicationUser</span><span style="color:#FFB86C;font-style:italic"> user</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#FF79C6">        var</span><span style="color:#F8F8F2"> identity </span><span style="color:#FF79C6">=</span><span style="color:#FF79C6"> await</span><span style="color:#BD93F9;font-style:italic"> base</span><span style="color:#F8F8F2">.</span><span style="color:#50FA7B">GenerateClaimsAsync</span><span style="color:#F8F8F2">(user);</span></span>
<span class="line"><span style="color:#F8F8F2">        identity.</span><span style="color:#50FA7B">AddClaim</span><span style="color:#F8F8F2">(</span><span style="color:#FF79C6">new</span><span style="color:#8BE9FD;font-style:italic"> Claim</span><span style="color:#F8F8F2">(</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">ContactName</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">, user.ContactName </span><span style="color:#FF79C6">??</span><span style="color:#E9F284"> &quot;&quot;</span><span style="color:#F8F8F2">));</span></span>
<span class="line"><span style="color:#FF79C6">        return</span><span style="color:#F8F8F2"> identity;</span></span>
<span class="line"><span style="color:#F8F8F2">    }</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<p>And then register it in DI container in <code>ConfigureServices</code> methods of your Startup class:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#FF79C6">public</span><span style="color:#FF79C6"> void</span><span style="color:#50FA7B"> ConfigureServices</span><span style="color:#F8F8F2">(</span><span style="color:#8BE9FD;font-style:italic">IServiceCollection</span><span style="color:#FFB86C;font-style:italic"> services</span><span style="color:#F8F8F2">) {</span></span>
<span class="line"><span style="color:#F8F8F2">    .     .     .     .      .</span></span>
<span class="line"><span style="color:#F8F8F2">    services.</span><span style="color:#50FA7B">AddIdentity</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ApplicationUser</span><span style="color:#F8F8F2">, </span><span style="color:#8BE9FD;font-style:italic">IdentityRole</span><span style="color:#F8F8F2">&gt;()</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#50FA7B">AddEntityFrameworkStores</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ApplicationDbContext</span><span style="color:#F8F8F2">&gt;()</span></span>
<span class="line"><span style="color:#F8F8F2">        .</span><span style="color:#50FA7B">AddDefaultTokenProviders</span><span style="color:#F8F8F2">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4">    //add the following line of code</span></span>
<span class="line"><span style="color:#F8F8F2">    services.</span><span style="color:#50FA7B">AddScoped</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">IUserClaimsPrincipalFactory</span><span style="color:#F8F8F2">&lt;</span><span style="color:#8BE9FD;font-style:italic">ApplicationUser</span><span style="color:#F8F8F2">&gt;, </span><span style="color:#8BE9FD;font-style:italic">MyUserClaimsPrincipalFactory</span><span style="color:#F8F8F2">&gt;();</span></span>
<span class="line"><span style="color:#F8F8F2">    .     .     .     .      .</span></span>
<span class="line"><span style="color:#F8F8F2">}</span></span></code></pre>
<h3 id="2-accessing-new-claim-from-the-views">2. Accessing new claim from the views</h3>
<p>Now we have a new claim associated with our user’s identity. That’s fine. But how we can get it and render on our view(s)?
Easy. Any view in your application has access to <code>User</code> object which is an instance of <code>ClaimsPrincipal</code> class.</p>
<p>This object actually holds the list of all claims associated with the current user and you can call its <code>FindFirst</code> method to get the necessary claim and then read the <code>Value</code> property of the found claim.</p>
<p>So, we just need to open <code>_LoginPartical.cshtml</code> file in <code>Views/Shared/</code> folder and replace the following line:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">a</span><span style="color:#50FA7B;font-style:italic"> asp-area</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#50FA7B;font-style:italic"> asp-controller</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Manage</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> asp-action</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Index</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> title</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Manage</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">&gt;Hello @UserManager.GetUserName(User)!&lt;/</span><span style="color:#FF79C6">a</span><span style="color:#F8F8F2">&gt;</span></span></code></pre>
<p>with this one:</p>
<pre class="astro-code dracula" style="background-color:#282A36;color:#F8F8F2;overflow-x:auto" tabindex="0"><code><span class="line"><span style="color:#F8F8F2">&lt;</span><span style="color:#FF79C6">a</span><span style="color:#50FA7B;font-style:italic"> asp-area</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;&quot;</span><span style="color:#50FA7B;font-style:italic"> asp-controller</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Manage</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> asp-action</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Index</span><span style="color:#E9F284">&quot;</span><span style="color:#50FA7B;font-style:italic"> title</span><span style="color:#FF79C6">=</span><span style="color:#E9F284">&quot;</span><span style="color:#F1FA8C">Manage</span><span style="color:#E9F284">&quot;</span><span style="color:#F8F8F2">&gt;Hello @(User.FindFirst(&quot;ContactName&quot;).Value)!&lt;/</span><span style="color:#FF79C6">a</span><span style="color:#F8F8F2">&gt;</span></span></code></pre>
<p>Now you instead of something like <code>Hello john.doe@yourcompany.com</code> at the top of your web-page you should see something like this:</p>
<img src="/_astro/anc-identity-contact-name.I5L-C5go_Z1XIXzc.webp" alt="ASP.NET Core - renderring contact name instead of user's ID" width="1227" height="593" loading="lazy" decoding="async">  </div> </div> </div> <div class="cell-md-3" data-astro-cid-2q5oecfc> <div class="sidebar border-left bd-default pl-4 pr-4" data-astro-cid-2q5oecfc> <div data-astro-cid-2q5oecfc> <div class="text-bold enlarge-1 border-bottom bd-default" data-astro-cid-2q5oecfc>Table of Contents</div> <nav class="toc"> <ul> <li> <a href="#introduction"> Introduction </a>  </li><li> <a href="#problem"> Problem </a>  </li><li> <a href="#solution"> Solution </a> <ul> <li> <a href="#0-preparations-contactname-property-in-applicationuser-and-updated-views"> 0. Preparations: ContactName property in ApplicationUser and updated views </a>  </li><li> <a href="#1-adding-a-users-name-to-the-claims"> 1. Adding a user’s name to the claims </a>  </li><li> <a href="#2-accessing-new-claim-from-the-views"> 2. Accessing new claim from the views </a>  </li> </ul> </li> </ul> </nav> </div> <div class="mt-6" data-astro-cid-2q5oecfc> <div class="text-bold border-bottom bd-default" data-astro-cid-2q5oecfc>Related posts</div> <ul class="post-links"> <li class="post-link"><a class="link-to-post" href="/blog/aspnet-identity-weakening-password-policies">ASP.NET Identity - Weakening password policies</a></li> </ul> </div> <div class="mt-6" data-astro-cid-2q5oecfc> <div class="text-bold border-bottom bd-default" data-astro-cid-2q5oecfc>Recent posts</div> <ul class="post-links"> <li class="post-link"><a class="link-to-post" href="/blog/aspnet-identity-store-user-data-in-claims">ASP.NET Identity - Use claims to store additional user&#39;s data</a></li><li class="post-link"><a class="link-to-post" href="/blog/aspnet-identity-weakening-password-policies">ASP.NET Identity - Weakening password policies</a></li><li class="post-link"><a class="link-to-post" href="/blog/aspnet-identity-migrate-membership-passwords">ASP.NET Identity - Migrating users&#39; passwords from ASP.NET Membership</a></li><li class="post-link"><a class="link-to-post" href="/blog/aspnet-identity-master-password">ASP.NET Identity - Adding master password</a></li><li class="post-link"><a class="link-to-post" href="/blog/embedded-resources-testing-projects">Using embedded resources in testing projects</a></li> </ul> </div> <div class="mt-6" data-astro-cid-2q5oecfc> <div class="text-bold border-bottom bd-default" data-astro-cid-2q5oecfc>Tags</div> <div class="mt-1" data-astro-cid-2q5oecfc> <a class="tag" href="/blog/tags/ASP-NET-CORE" data-astro-cid-2q5oecfc>ASP-NET-CORE</a><a class="tag" href="/blog/tags/ASP-NET-IDENTITY" data-astro-cid-2q5oecfc>ASP-NET-IDENTITY</a><a class="tag" href="/blog/tags/CLAIMS" data-astro-cid-2q5oecfc>CLAIMS</a> </div> </div> </div> </div> </div> </div> </section>  </main> <footer class="container-fluid mt-auto"> <div class="container"> <ul class="footer__menu"> <li><a href="/">HOME</a></li> <li><a href="/easyquery">EASYQUERY.NET</a></li> <li><a href="/metroui">METRO UI</a></li> <li><a href="/localizer">LOCALIZER</a></li> <li><a href="/blog">BLOG</a></li> <li><a href="/support">SUPPORT</a></li> <li><a href="/resellers">RESELLERS FAQ</a></li> <li><a href="/account">YOUR ACCOUNT</a></li> <li><a href="/privacy">PRIVACY</a></li> <li><a href="/terms-of-use">TERMS OF USE</a></li> </ul> <hr class="mt-10 mb-10 thin"> <div class="d-flex flex-column flex-align-center"> <div>1998-2023 &copy; Korzh.com. Made in Ukraine. All Rights Reserved.</div> <div class="mute-text">All product names, logos, and brands are the property of their respective owners.</div> <div>
Site built with <a class="fg-yellow no-decor" href="/metroui">Metro UI</a>. Powered by <a class="fg-yellow no-decor" href="https://astro.build">Astro</a>.
</div> </div> </div> </footer>   </body> </html> 